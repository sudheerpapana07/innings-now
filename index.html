<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mini CREX ‚Äî Live Cricket Score</title>

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#071127;        /* dark navy background */
      --card:#071427;
      --panel:#0d1a2a;
      --muted:#94a3b8;
      --text:#e8f0f8;
      --accent:#22c55e;    /* green accent like crex */
      --accent-2:#06b6d4;  /* cyan accent */
      --chip:#0f2433;
      --border:rgba(148,163,184,0.07);
    }

    *{box-sizing:border-box;margin:0;padding:0;font-family:'Poppins',system-ui,-apple-system,"Segoe UI",Roboto,sans-serif}
    body{background:var(--bg);color:var(--text);min-height:100vh;padding:10px}
    .app{max-width:1100px;margin:0 auto;padding:12px}

    /* header */
    .app-header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
    .status-dot{width:10px;height:10px;border-radius:999px;background:var(--accent);box-shadow:0 0 8px var(--accent)}
    .status-text{color:var(--accent);font-weight:700;text-transform:uppercase;font-size:13px}
    .match-info{color:var(--muted);font-weight:600}

    /* match card */
    .match-card{background:linear-gradient(180deg,var(--card),#061026);border-radius:14px;padding:16px;border:1px solid var(--border);box-shadow:0 14px 40px rgba(2,6,23,0.6)}
    .team-row{display:flex;justify-content:space-between;align-items:baseline;margin-bottom:10px}
    .team-name{font-size:18px;font-weight:700;text-transform:uppercase;color:var(--text);max-width:70%;overflow:hidden;text-overflow:ellipsis}
    .team-score{font-size:34px;font-weight:800;color:var(--text)}
    .overs{font-size:13px;color:var(--muted);margin-left:8px}

    /* timeline + cheer */
    .timeline-row{display:flex;align-items:center;gap:14px;margin-top:6px}
    .mini-ball-strip{
      display:flex;gap:6px;overflow-x:auto;padding:6px;
      flex:0 0 420px;max-width:64%;
      background:transparent;border-radius:999px;scroll-behavior:smooth;
    }
    @media(max-width:720px){.mini-ball-strip{flex:0 0 58vw;max-width:58vw}}
    .mini-ball-strip::-webkit-scrollbar{height:6px}
    .mini-ball-chip{min-width:26px;padding:6px 8px;border-radius:999px;background:var(--chip);color:var(--text);font-size:12px;text-align:center}
    .mini-ball-chip.over-label{background:var(--accent-2);color:#e9f2ff;font-weight:700}
    .cheer-box{width:86px;min-height:68px;border-radius:12px;background:var(--panel);border:1px solid var(--border);display:flex;flex-direction:column;align-items:center;justify-content:center;padding:8px}
    .cheer-emoji{font-size:30px;margin-bottom:4px}
    .cheer-text{font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:0.06em}
    .cheer-box.animate{animation:cheer-pop .45s ease-out}
    @keyframes cheer-pop{0%{transform:scale(.6);opacity:0}40%{transform:scale(1.06);opacity:1}100%{transform:scale(1);opacity:1}}

    .match-summary{margin-top:8px;text-align:center;color:#ffd24d;font-weight:700}
    .info-row{display:flex;gap:8px;justify-content:space-between;margin-top:12px;font-size:13px;color:var(--muted);align-items:center}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:transparent;border:1px solid var(--border)}
    .pill-label{font-size:11px;color:var(--muted);text-transform:uppercase}
    .pill-value{font-weight:700;color:var(--text)}

    /* result banner */
    #result-banner{display:none;margin-top:12px;padding:10px;border-radius:10px;background:linear-gradient(90deg, rgba(34,197,94,0.06), rgba(6,182,212,0.04));color:#ffd966;font-weight:800;text-align:center;border:1px solid rgba(255,215,102,0.06)}

    /* tabs */
    .tabs{display:flex;gap:8px;margin-top:16px;margin-bottom:12px}
    .tab{flex:1;padding:10px;border-radius:999px;background:transparent;border:1px solid var(--border);color:var(--muted);text-align:center;cursor:pointer;font-weight:700}
    .tab.active{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#021019;box-shadow:0 6px 18px rgba(6,182,212,0.06)}

    .tab-panel{display:none;background:linear-gradient(180deg,#071122, #071026);padding:14px;border-radius:12px;border:1px solid var(--border)}
    .tab-panel.active{display:block}

    /* forms */
    .input-row{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:12px}
    .field{flex:1;min-width:140px}
    .field-label{font-size:12px;color:var(--muted);margin-bottom:6px}
    .text-input{width:100%;padding:9px;border-radius:10px;background:#071226;border:1px solid var(--border);color:var(--text)}

    .mini-btn{background:var(--accent);border:none;padding:8px 12px;border-radius:10px;font-weight:700;color:#021019;cursor:pointer}

    /* xi */
    .xi-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .xi-card{background:var(--panel);padding:12px;border-radius:10px;border:1px solid var(--border)}
    .players-box{max-height:260px;overflow:auto;padding-right:6px;margin-top:8px}
    .player-input-row{display:flex;align-items:center;gap:8px;margin-bottom:8px}
    .player-index{width:22px;color:var(--muted);text-align:right;font-size:13px}

    /* controls */
    .controls-title{font-size:13px;color:var(--muted);margin-bottom:8px}
    .controls-row{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:8px}
    .score-btn{flex:1;min-width:56px;padding:10px;border-radius:10px;border:1px solid var(--border);background:transparent;color:var(--text);cursor:pointer;font-weight:700}
    .score-btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#021019}
    .score-btn.danger{background:#ef4444;color:#021019}
    .score-btn.reset{background:#0b1220;color:var(--muted)}

    /* win prob */
    #win-prob{margin-top:8px;display:flex;align-items:center;gap:10px;color:var(--muted);font-weight:600;font-size:13px}
    #win-prob .bar{height:12px;flex:1;background:rgba(255,255,255,0.04);border-radius:999px;overflow:hidden}
    #win-prob .bar-inner{height:12px;background:linear-gradient(90deg,var(--accent),var(--accent-2));width:0%;transition:width .35s ease;border-radius:999px}
    #win-prob .pct{min-width:48px;text-align:right;font-weight:700;color:var(--text)}

    /* live/scorecard layout */
    .live-grid{display:grid;grid-template-columns:2fr 1fr;gap:12px;margin-top:12px}
    .live-card,.innings-block{background:var(--panel);padding:12px;border-radius:10px;border:1px solid var(--border)}
    .live-card-title{font-weight:800;color:var(--muted);margin-bottom:8px}

    /* TABLE alignment fixes */
    .table, .live-table{width:100%;border-collapse:collapse;table-layout:fixed;font-size:14px}
    .table th, .table td, .live-table th, .live-table td{padding:10px 8px;border-top:1px solid rgba(255,255,255,0.02)}
    /* columns: 1=name left, 2=dismissal left, rest numeric right */
    .table th:nth-child(1), .table td:nth-child(1),
    .live-table th:nth-child(1), .live-table td:nth-child(1){text-align:left;width:45%}
    .table th:nth-child(2), .table td:nth-child(2){text-align:left;width:25%; color:var(--muted)}
    .table th:nth-child(3), .table td:nth-child(3),
    .table th:nth-child(4), .table td:nth-child(4),
    .table th:nth-child(5), .table td:nth-child(5),
    .table th:nth-child(6), .table td:nth-child(6),
    .table th:nth-child(7), .table td:nth-child(7){text-align:right}

    .live-table th{color:var(--muted);text-align:left}
    .live-table td{text-align:right}

    /* popup */
    .dismissal-overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.6);z-index:60;padding:14px}
    .dismissal-card{width:100%;max-width:420px;background:linear-gradient(180deg,#081224,#071026);padding:12px;border-radius:12px;border:1px solid var(--border)}
    .dismissal-actions{display:flex;justify-content:flex-end;margin-top:12px;gap:8px}

    @media (max-width:900px){
      .live-grid{grid-template-columns:1fr}
      .xi-grid{grid-template-columns:1fr}
      .team-score{font-size:26px}
    }
  </style>
</head>
<body>
  <div class="app">

    <!-- HEADER -->
    <header class="app-header">
      <div class="status-dot"></div>
      <div class="status-text">Live</div>
      <div class="match-info"><span class="team-a-name">TEAM A</span> vs <span class="team-b-name">TEAM B</span></div>
    </header>

    <!-- MATCH CARD -->
    <section class="match-card">
      <div class="team-row">
        <div class="team-name" id="current-team-name">TEAM A</div>
        <div class="team-score">
          <span id="current-runs">0</span>-<span id="current-wkts">0</span>
          <span class="overs">(<span id="current-overs">0.0</span>)</span>
        </div>
      </div>

      <div class="timeline-row">
        <div class="mini-ball-strip" id="mini-ball-strip" aria-hidden="false"></div>
        <div class="cheer-box" id="cheer-box">
          <div class="cheer-emoji" id="cheer-emoji">üôã‚Äç‚ôÄÔ∏è</div>
          <div class="cheer-text" id="cheer-text">ready</div>
        </div>
      </div>

      <div class="match-summary" id="match-summary">TEAM A ‚Ä¢ 0/0 (0.0)</div>

      <div id="result-banner"></div>

      <div class="info-row">
        <div class="pill">
          <div class="pill-label">CRR</div>
          <div class="pill-value" id="current-rr">0.0</div>
        </div>

        <!-- target pill (hidden in 1st innings) -->
        <div class="pill" id="target-pill" style="display:none;">
          <div class="pill-label">Target</div>
          <div class="pill-value" id="target-value">0</div>
        </div>

        <div class="pill">
          <div class="pill-label">Status</div>
          <div class="pill-value" id="innings-label">1st innings</div>
        </div>
      </div>
    </section>

    <!-- TABS -->
    <nav class="tabs" role="tablist" aria-label="Main tabs">
      <button class="tab active" data-tab="match-info" role="tab">Match info</button>
      <button class="tab" data-tab="live" role="tab">Live</button>
      <button class="tab" data-tab="scorecard" role="tab">Scorecard</button>
    </nav>

    <!-- PANELS -->
    <main>
      <!-- MATCH INFO -->
      <section id="match-info" class="tab-panel active" role="tabpanel">
        <div class="section-title">Match setup</div>
        <div class="section-subtitle" style="color:var(--muted);margin-bottom:8px">Edit teams, overs and playing XI</div>

        <div class="input-row">
          <div class="field">
            <div class="field-label">Team A name</div>
            <input id="teamA-name-input" class="text-input" placeholder="Team A" />
          </div>
          <div class="field">
            <div class="field-label">Team B name</div>
            <input id="teamB-name-input" class="text-input" placeholder="Team B" />
          </div>
          <div class="field" style="max-width:140px">
            <div class="field-label">Overs</div>
            <input id="max-overs-input" class="text-input" type="number" min="1" max="90" value="20" />
          </div>
          <div style="display:flex;align-items:center">
            <button class="mini-btn" id="apply-teams-btn">Apply</button>
          </div>
        </div>

        <div class="xi-grid">
          <div class="xi-card">
            <div class="section-title">Team A XI</div>
            <div id="teamA-players-box" class="players-box"></div>
          </div>
          <div class="xi-card">
            <div class="section-title">Team B XI</div>
            <div id="teamB-players-box" class="players-box"></div>
          </div>
        </div>
      </section>

      <!-- LIVE -->
      <section id="live" class="tab-panel" role="tabpanel">
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px">
          <div style="font-size:13px;color:var(--muted)">Current batting</div>
          <button class="mini-btn innings-btn active" id="inningsA-btn">Team A</button>
          <button class="mini-btn innings-btn" id="inningsB-btn">Team B</button>
        </div>

        <div class="controls-title" id="controls-title">Score controls ‚Äî Team A innings</div>

        <div class="controls-row">
          <button class="score-btn primary" data-runs="0">Dot</button>
          <button class="score-btn primary" data-runs="1">+1</button>
          <button class="score-btn primary" data-runs="2">+2</button>
          <button class="score-btn primary" data-runs="3">+3</button>
          <button class="score-btn primary" data-runs="4">+4</button>
          <button class="score-btn primary" data-runs="6">+6</button>
          <button class="score-btn danger" id="wicket-btn">W</button>
        </div>

        <div class="controls-row">
          <button class="score-btn" data-extra="NB">No ball</button>
          <button class="score-btn" data-extra="WD">Wide</button>
          <button class="score-btn" data-extra="LB">Leg byes</button>
          <button class="score-btn reset" id="reset-innings-btn">Reset innings</button>
        </div>

        <!-- win probability -->
        <div id="win-prob">
          <div style="font-size:12px;color:var(--muted);">Win probability</div>
          <div class="bar"><div class="bar-inner" id="win-bar"></div></div>
          <div class="pct" id="win-pct">50%</div>
        </div>

        <div class="live-grid">
          <div class="live-card">
            <div class="live-card-title">Live batters</div>
            <table class="live-table" aria-describedby="live batters">
              <thead><tr><th>Name</th><th>R</th><th>B</th><th>4s</th><th>6s</th></tr></thead>
              <tbody id="live-batters"></tbody>
            </table>
          </div>

          <div class="live-card">
            <div class="live-card-title">Current bowler</div>
            <table class="live-table">
              <thead><tr><th>Name</th><th>O</th><th>R</th><th>W</th></tr></thead>
              <tbody id="live-bowler"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- SCORECARD -->
      <section id="scorecard" class="tab-panel" role="tabpanel">
        <div class="section-title">Scorecard</div>

        <div class="innings-grid">
          <div class="innings-block">
            <div class="innings-title" id="inningsA-title">TEAM A Innings ‚Ä¢ 0/0 (0.0)</div>
            <div class="innings-subtitle" style="color:var(--muted);margin:8px 0">Batting</div>
            <table class="table" aria-label="Team A batting">
              <thead><tr><th>Batter</th><th>Dismissal</th><th>R</th><th>B</th><th>4s</th><th>6s</th><th>SR</th></tr></thead>
              <tbody id="teamA-batters-body"></tbody>
              <tfoot><tr><td>Extras</td><td id="teamA-extras-text" colspan="6" style="text-align:left;color:var(--muted)"></td></tr></tfoot>
            </table>
          </div>

          <div class="innings-block">
            <div class="innings-title" id="inningsB-title">TEAM B Innings ‚Ä¢ 0/0 (0.0)</div>
            <div class="innings-subtitle" style="color:var(--muted);margin:8px 0">Batting</div>
            <table class="table" aria-label="Team B batting">
              <thead><tr><th>Batter</th><th>Dismissal</th><th>R</th><th>B</th><th>4s</th><th>6s</th><th>SR</th></tr></thead>
              <tbody id="teamB-batters-body"></tbody>
              <tfoot><tr><td>Extras</td><td id="teamB-extras-text" colspan="6" style="text-align:left;color:var(--muted)"></td></tr></tfoot>
            </table>
          </div>
        </div>

        <div class="innings-subtitle" style="margin-top:12px;color:var(--muted)">Bowling (current innings)</div>
        <table class="table" aria-label="Bowling card"><thead><tr><th>Bowler</th><th>O</th><th>R</th><th>W</th><th>Eco</th></tr></thead><tbody id="bowling-card"></tbody></table>

        <div class="innings-subtitle" style="margin-top:12px;color:var(--muted)">Fall of wickets</div>
        <table class="table" aria-label="Fall of wickets"><thead><tr><th>Score</th><th>Over</th><th>Batter</th></tr></thead><tbody id="fall-wickets"></tbody></table>

        <div class="innings-subtitle" style="margin-top:12px;color:var(--muted)">Partnerships</div>
        <table class="table" aria-label="Partnerships"><thead><tr><th>Pair</th><th>Runs</th><th>Balls</th></tr></thead><tbody id="partnerships"></tbody></table>
      </section>
    </main>
  </div>

  <!-- wicket popup -->
  <div class="dismissal-overlay" id="dismissal-overlay">
    <div class="dismissal-card">
      <div class="dismissal-header" style="font-weight:800;color:var(--muted)">Wicket details</div>
      <div class="dismissal-sub" style="margin-bottom:8px;color:var(--muted)">Example: c Rahul b Bumrah</div>
      <div>
        <div class="field-label" style="color:var(--muted)">How out?</div>
        <input id="dismissal-text-input" class="text-input" />
      </div>
      <div class="dismissal-actions">
        <button class="mini-btn" id="dismissal-cancel-btn">Cancel</button>
        <button class="mini-btn" id="dismissal-save-btn">Save</button>
      </div>
    </div>
  </div>

  <script>
  document.addEventListener("DOMContentLoaded", () => {

    /* ====== STATE ====== */
    let maxOvers = 20;
    let currentInnings = "A";
    let teamNames = { A: "Team A", B: "Team B" };
    let playingXI = { A: [], B: [] };
    let innings = {
      A: { batters: [], extras:{wd:0,nb:0,lb:0}, runs:0, wkts:0, balls:0, striker:0, nonStriker:1 },
      B: { batters: [], extras:{wd:0,nb:0,lb:0}, runs:0, wkts:0, balls:0, striker:0, nonStriker:1 }
    };
    let bowlingStats = { A: {}, B: {} };
    let fallWickets = { A: [], B: [] };
    let partnerships = { A: [], B: [] };
    let currentBowler = { A: null, B: null };
    let partnershipRuns = 0, partnershipBalls = 0;

    /* ====== ELEMENTS ====== */
    const strip = document.getElementById("mini-ball-strip");
    const cheerBox = document.getElementById("cheer-box");
    const cheerEmoji = document.getElementById("cheer-emoji");
    const cheerText = document.getElementById("cheer-text");
    const popup = document.getElementById("dismissal-overlay");
    const popupInput = document.getElementById("dismissal-text-input");
    const resultBanner = document.getElementById("result-banner");
    const winBar = document.getElementById("win-bar");
    const winPct = document.getElementById("win-pct");

    /* ====== HELPERS ====== */
    function formatOvers(balls){ return Math.floor(balls/6) + "." + (balls%6); }
    function rotateStrike(inn){ const t=inn.striker; inn.striker=inn.nonStriker; inn.nonStriker=t; }
    function ensureBowler(name){ if(!bowlingStats[currentInnings][name]) bowlingStats[currentInnings][name] = { name, balls:0, runs:0, wkts:0 }; }

    /* ====== TIMELINE & CHEER ====== */
    function addOverLabel(n){
      const chip = document.createElement("div");
      chip.className = "mini-ball-chip over-label";
      chip.textContent = "Ov " + n;
      strip.appendChild(chip);
    }
    function addTimelineBall(sym){
      const chip = document.createElement("div");
      chip.className = "mini-ball-chip";
      chip.textContent = sym;
      strip.appendChild(chip);
      strip.scrollLeft = strip.scrollWidth;
      // clamp to last ~12 chips visually (remove old if too many)
      while(strip.children.length > 40) strip.removeChild(strip.firstChild);
    }
    function showCheer(sym){
      let emo="üôã‚Äç‚ôÄÔ∏è", txt="nice";
      if(sym==="0"){ emo="üôÇ"; txt="Dot" }
      else if(sym==="1"){ emo="üòä"; txt="+1" }
      else if(sym==="2"||sym==="3"){ emo="üòÑ"; txt=`${sym} runs` }
      else if(sym==="4"){ emo="ü§©"; txt="FOUR" }
      else if(sym==="6"){ emo="üéâ"; txt="SIX" }
      else if(sym==="WD"||sym==="NB"){ emo="üôÜ‚Äç‚ôÄÔ∏è"; txt=sym }
      else if(sym==="LB"){ emo="üôÇ"; txt="Leg bye" }
      else if(sym==="W"){ emo="üò¢"; txt="WICKET" }
      cheerEmoji.textContent = emo;
      cheerText.textContent = txt;
      cheerBox.classList.remove("animate");
      void cheerBox.offsetWidth;
      cheerBox.classList.add("animate");
    }

    /* ====== UI UPDATES ====== */
    function updateTopCard(){
      const inn = innings[currentInnings];
      document.getElementById("current-team-name").textContent = teamNames[currentInnings];
      document.getElementById("current-runs").textContent = inn.runs;
      document.getElementById("current-wkts").textContent = inn.wkts;
      document.getElementById("current-overs").textContent = formatOvers(inn.balls);

      const rr = inn.balls > 0 ? (inn.runs * 6 / inn.balls).toFixed(1) : "0.0";
      document.getElementById("current-rr").textContent = rr;

      let summary = `${teamNames[currentInnings]} ‚Ä¢ ${inn.runs}/${inn.wkts} (${formatOvers(inn.balls)})`;
      document.getElementById("innings-label").textContent = currentInnings === "A" ? "1st innings" : "2nd innings";

      const targetPill = document.getElementById("target-pill");

      if(currentInnings === "B" && innings.A.runs > 0){
        const target = innings.A.runs + 1;
        targetPill.style.display = "inline-flex";
        document.getElementById("target-value").textContent = target;

        const remRuns = Math.max(0, target - inn.runs);
        const remBalls = maxOvers * 6 - inn.balls;

        if(remRuns > 0 && remBalls > 0){
          summary = `${teamNames.B} need ${remRuns} in ${remBalls} balls (Target ${target})`;
        } else if(remRuns <= 0){
          summary = `${teamNames.B} have chased target ${target - 1}`;
        } else {
          summary = `Target ${target} ‚Äî Innings complete`;
        }
      } else {
        targetPill.style.display = "none";
      }

      document.getElementById("match-summary").textContent = summary;

      // update win prob UI as part of top update
      updateWinProbUI();
    }

    function updateLiveBatters(){
      const inn = innings[currentInnings];
      const s = inn.batters[inn.striker] || {name:"--",runs:0,balls:0,fours:0,sixes:0};
      const ns = inn.batters[inn.nonStriker] || {name:"--",runs:0,balls:0,fours:0,sixes:0};
      document.getElementById("live-batters").innerHTML = `
        <tr>
          <td style="text-align:left">${s.name} *</td><td>${s.runs}</td><td>${s.balls}</td><td>${s.fours}</td><td>${s.sixes}</td>
        </tr>
        <tr>
          <td style="text-align:left">${ns.name}</td><td>${ns.runs}</td><td>${ns.balls}</td><td>${ns.fours}</td><td>${ns.sixes}</td>
        </tr>`;
    }

    function updateLiveBowler(){
      const name = currentBowler[currentInnings];
      if(!name){ document.getElementById("live-bowler").innerHTML = ""; return; }
      const b = bowlingStats[currentInnings][name] || {name,balls:0,runs:0,wkts:0};
      document.getElementById("live-bowler").innerHTML = `<tr><td style="text-align:left">${name}</td><td>${formatOvers(b.balls)}</td><td>${b.runs}</td><td>${b.wkts}</td></tr>`;
    }

    function updateScorecard(){
      ["A","B"].forEach(k=>{
        const inn = innings[k];
        const body = document.getElementById(`team${k}-batters-body`);
        body.innerHTML = "";
        (inn.batters || []).forEach(b => {
          const sr = b.balls ? ((b.runs / b.balls) * 100).toFixed(1) : "0.0";
          body.innerHTML += `<tr><td style="text-align:left">${b.name}</td><td style="text-align:left;color:var(--muted)">${b.dismissal||""}</td><td>${b.runs}</td><td>${b.balls}</td><td>${b.fours}</td><td>${b.sixes}</td><td>${sr}</td></tr>`;
        });
        const ex = inn.extras;
        document.getElementById(`team${k}-extras-text`).textContent = `Wd ${ex.wd}, Nb ${ex.nb}, Lb ${ex.lb}`;
        document.getElementById(`innings${k}-title`).textContent = `${teamNames[k]} Innings ‚Ä¢ ${inn.runs}/${inn.wkts} (${formatOvers(inn.balls)})`;
      });
    }

    function updateBowlingCard(){
      const bowlers = bowlingStats[currentInnings] || {};
      let html = "";
      Object.values(bowlers).forEach(b=>{
        if(!b.balls) return;
        const eco = (b.balls>0) ? (b.runs / (b.balls/6)).toFixed(1) : "0.0";
        html += `<tr><td style="text-align:left">${b.name}</td><td>${formatOvers(b.balls)}</td><td>${b.runs}</td><td>${b.wkts}</td><td>${eco}</td></tr>`;
      });
      document.getElementById("bowling-card").innerHTML = html;
    }

    function updateFallWickets(){
      const arr = fallWickets[currentInnings] || [];
      let html = "";
      arr.forEach(fw => html += `<tr><td>${fw.score}</td><td>${fw.over}</td><td style="text-align:left">${fw.batter}</td></tr>`);
      document.getElementById("fall-wickets").innerHTML = html;
    }

    function updatePartnerships(){
      const arr = partnerships[currentInnings] || [];
      let html = "";
      arr.forEach(p => html += `<tr><td style="text-align:left">${p.pair}</td><td>${p.runs}</td><td>${p.balls}</td></tr>`);
      document.getElementById("partnerships").innerHTML = html;
    }

    function updateEverything(){
      updateTopCard();
      updateLiveBatters();
      updateLiveBowler();
      updateScorecard();
      updateBowlingCard();
      updateFallWickets();
      updatePartnerships();
    }

    /* ====== Enable/Disable and End innings ====== */
    function setScoringEnabled(enabled){
      document.querySelectorAll(".score-btn, #wicket-btn, #reset-innings-btn").forEach(b=>{
        b.disabled = !enabled;
        b.style.opacity = enabled ? "1" : "0.45";
        b.style.pointerEvents = enabled ? "auto" : "none";
      });
    }

    function computeWinProbability() {
      // Simple heuristic for display only.
      const inn = innings[currentInnings];
      if(currentInnings === "A") return 50;
      const target = innings.A.runs + 1;
      const remRuns = Math.max(0, target - inn.runs);
      const remBalls = Math.max(0, maxOvers * 6 - inn.balls);
      if(remRuns <= 0) return 99;
      if(remBalls === 0) return 1;
      const reqRpo = remRuns / (remBalls / 6 || 1);
      const currentRpo = (inn.balls > 0) ? (inn.runs * 6 / inn.balls) : 0;
      let delta = currentRpo - reqRpo;
      let shift = Math.round(delta * 7.5 * 10) / 10;
      let base = 50 + shift;
      const wicketsLeft = 10 - inn.wkts;
      base += (wicketsLeft - 5) * 2;
      let prob = Math.max(1, Math.min(99, Math.round(base)));
      return prob;
    }

    function updateWinProbUI(){
      if(!winBar || !winPct) return;
      const prob = computeWinProbability();
      winBar.style.width = prob + "%";
      winPct.textContent = prob + "%";
    }

    function endInnings(){
      const innKey = currentInnings;
      const inn = innings[innKey];
      setScoringEnabled(false);
      const finalScore = `${teamNames[innKey]} finished ${inn.runs}/${inn.wkts} (${formatOvers(inn.balls)})`;

      if(innKey === "A"){
        const target = innings.A.runs + 1;
        document.getElementById("target-pill").style.display = "inline-flex";
        document.getElementById("target-value").textContent = target;
        document.getElementById("match-summary").textContent = `${finalScore} ‚Äî Switch to ${teamNames.B} (target ${target})`;

        setTimeout(()=>{
          currentInnings = "B";
          document.getElementById("inningsB-btn").classList.add("active");
          document.getElementById("inningsA-btn").classList.remove("active");
          document.getElementById("controls-title").textContent = `Score controls ‚Äî ${teamNames.B} innings`;
          setScoringEnabled(true);
          updateEverything();
        }, 600);
      } else {
        const target = innings.A.runs + 1;
        let resultText = "";
        if(inn.runs >= target){
          const byWkts = 10 - inn.wkts;
          resultText = `${teamNames.B} won by ${byWkts} wickets`;
        } else {
          const diff = target - inn.runs - 1;
          resultText = `${teamNames.A} won by ${diff} runs`;
        }
        document.getElementById("match-summary").textContent = finalScore + " ‚Äî " + resultText;
        resultBanner.style.display = "block";
        resultBanner.textContent = resultText;
        setTimeout(()=>{ resultBanner.style.display = "none"; }, 16000);
        setScoringEnabled(false);
      }
      updateEverything();
    }

    /* ====== WICKET POPUP ====== */
    let wicketCallback = null;
    function openWicketPopup(cb){
      wicketCallback = cb;
      popup.style.display = "flex";
      popupInput.value = "";
      popupInput.focus();
    }
    document.getElementById("dismissal-cancel-btn").onclick = () => { popup.style.display = "none"; }
    document.getElementById("dismissal-save-btn").onclick = () => {
      const txt = popupInput.value.trim() || "b Bowler";
      const inn = innings[currentInnings];
      if(inn && inn.batters && inn.batters[inn.striker]) inn.batters[inn.striker].dismissal = txt;
      popup.style.display = "none";
      wicketCallback && wicketCallback();
    }

    /* ====== CORE scoring logic ====== */
    function recordBall(runs, extraType = null, isWicket = false){
      const inn = innings[currentInnings];
      if(!inn.batters || inn.batters.length === 0) return;

      const striker = inn.batters[inn.striker];

      const bowlerName = currentBowler[currentInnings] || "Bowler";
      currentBowler[currentInnings] = bowlerName;
      ensureBowler(bowlerName);
      const b = bowlingStats[currentInnings][bowlerName];

      if(extraType === "WD"){
        inn.runs++; inn.extras.wd++; b.runs++;
        addTimelineBall("WD"); showCheer("WD"); updateEverything(); return;
      }
      if(extraType === "NB"){
        inn.runs++; inn.extras.nb++; b.runs++;
        addTimelineBall("NB"); showCheer("NB"); updateEverything(); return;
      }
      if(extraType === "LB"){
        inn.runs += runs; inn.extras.lb += runs;
        inn.balls++; b.balls++; partnershipBalls++;
        if((inn.balls - 1) % 6 === 0) addOverLabel(Math.floor((inn.balls - 1)/6) + 1);
        addTimelineBall("LB"); showCheer("LB");
        if(inn.balls >= maxOvers*6 || inn.wkts >= 10){ endInnings(); return; }
        updateEverything(); return;
      }

      inn.balls++; b.balls++; partnershipBalls++;
      if((inn.balls - 1) % 6 === 0) addOverLabel(Math.floor((inn.balls - 1)/6) + 1);

      if(isWicket){
        b.wkts++;
        addTimelineBall("W"); showCheer("W");

        const prevStrikerName = striker.name;
        const prevNon = inn.batters[inn.nonStriker] ? inn.batters[inn.nonStriker].name : "--";

        openWicketPopup(()=>{
          inn.wkts++;
          fallWickets[currentInnings].push({ batter: prevStrikerName, score: `${inn.runs}/${inn.wkts}`, over: formatOvers(inn.balls) });
          partnerships[currentInnings].push({ pair: `${prevStrikerName} & ${prevNon}`, runs: partnershipRuns, balls: partnershipBalls });
          partnershipRuns = 0; partnershipBalls = 0;

          const nextIdx = inn.batters.findIndex(b => !b.dismissal && b.runs === 0 && b.balls === 0 && b.name !== prevStrikerName);
          if(nextIdx !== -1) inn.striker = nextIdx;

          if(inn.balls >= maxOvers*6 || inn.wkts >= 10){ endInnings(); return; }

          updateEverything();
        });

        return;
      }

      striker.runs += runs;
      striker.balls++; partnershipRuns += runs;
      inn.runs += runs; b.runs += runs;
      if(runs === 4) striker.fours++;
      if(runs === 6) striker.sixes++;

      addTimelineBall(String(runs)); showCheer(String(runs));

      if(runs % 2 === 1) rotateStrike(inn);
      if(inn.balls % 6 === 0) rotateStrike(inn);

      if(inn.balls >= maxOvers*6 || inn.wkts >= 10){ endInnings(); return; }

      if(currentInnings === "B" && innings.A.runs > 0){
        const target = innings.A.runs + 1;
        if(inn.runs >= target){
          document.getElementById("match-summary").textContent = `${teamNames.B} have chased ${target - 1}`;
          endInnings(); return;
        }
      }

      updateEverything();
    }

    /* ====== XI inputs and init ====== */
    function generateXIInputs(){
      const boxA = document.getElementById("teamA-players-box");
      const boxB = document.getElementById("teamB-players-box");
      boxA.innerHTML = ""; boxB.innerHTML = "";
      for(let i=1;i<=11;i++){
        boxA.insertAdjacentHTML("beforeend", `<div class="player-input-row"><div class="player-index">${i}</div><input class="text-input xiA" placeholder="Player ${i}" /></div>`);
        boxB.insertAdjacentHTML("beforeend", `<div class="player-input-row"><div class="player-index">${i}</div><input class="text-input xiB" placeholder="Player ${i}" /></div>`);
      }
    }

    function initInningsFromXI(){
      playingXI.A = Array.from(document.querySelectorAll(".xiA")).map(i => i.value || `Player ${Math.floor(Math.random()*900)}`);
      playingXI.B = Array.from(document.querySelectorAll(".xiB")).map(i => i.value || `Player ${Math.floor(Math.random()*900)}`);

      ["A","B"].forEach(k=>{
        innings[k].batters = playingXI[k].map(name => ({ name, runs:0, balls:0, fours:0, sixes:0, dismissal:"" }));
        innings[k].extras = { wd:0, nb:0, lb:0 };
        innings[k].runs = 0; innings[k].wkts = 0; innings[k].balls = 0;
        innings[k].striker = 0; innings[k].nonStriker = 1;
      });
      bowlingStats = { A:{}, B:{} };
      fallWickets = { A:[], B:[] };
      partnerships = { A:[], B:[] };
      partnershipRuns = 0; partnershipBalls = 0;
      strip.innerHTML = "";
      resultBanner.style.display = "none";
      updateEverything();
    }

    generateXIInputs();
    initInningsFromXI();

    /* ====== EVENT WIRES ====== */
    document.querySelectorAll(".tab").forEach(t => t.addEventListener("click", ()=>{
      document.querySelectorAll(".tab").forEach(x => x.classList.remove("active"));
      document.querySelectorAll(".tab-panel").forEach(p => p.classList.remove("active"));
      t.classList.add("active");
      const id = t.getAttribute("data-tab");
      document.getElementById(id).classList.add("active");
    }));

    document.getElementById("apply-teams-btn").addEventListener("click", ()=>{
      teamNames.A = document.getElementById("teamA-name-input").value || "Team A";
      teamNames.B = document.getElementById("teamB-name-input").value || "Team B";
      maxOvers = Math.max(1, parseInt(document.getElementById("max-overs-input").value) || 20);
      document.querySelector(".team-a-name").textContent = teamNames.A;
      document.querySelector(".team-b-name").textContent = teamNames.B;
      document.getElementById("controls-title").textContent = `Score controls ‚Äî ${teamNames[currentInnings]} innings`;
      initInningsFromXI();
    });

    document.getElementById("inningsA-btn").addEventListener("click", ()=>{
      currentInnings = "A";
      document.getElementById("inningsA-btn").classList.add("active");
      document.getElementById("inningsB-btn").classList.remove("active");
      document.getElementById("controls-title").textContent = `Score controls ‚Äî ${teamNames.A} innings`;
      updateEverything();
    });
    document.getElementById("inningsB-btn").addEventListener("click", ()=>{
      currentInnings = "B";
      document.getElementById("inningsB-btn").classList.add("active");
      document.getElementById("inningsA-btn").classList.remove("active");
      document.getElementById("controls-title").textContent = `Score controls ‚Äî ${teamNames.B} innings`;
      updateEverything();
    });

    document.querySelectorAll(".score-btn.primary").forEach(btn=>{
      btn.addEventListener("click", ()=> {
        const r = parseInt(btn.getAttribute("data-runs") || "0");
        recordBall(r, null, false);
      });
    });
    document.getElementById("wicket-btn").addEventListener("click", ()=> recordBall(0, null, true));
    document.querySelectorAll(".score-btn[data-extra]").forEach(btn=>{
      btn.addEventListener("click", ()=> recordBall(0, btn.getAttribute("data-extra"), false));
    });

    document.getElementById("reset-innings-btn").addEventListener("click", ()=> {
      innings[currentInnings].runs = 0;
      innings[currentInnings].wkts = 0;
      innings[currentInnings].balls = 0;
      innings[currentInnings].extras = { wd:0, nb:0, lb:0 };
      innings[currentInnings].batters.forEach(b => { b.runs=0;b.balls=0;b.fours=0;b.sixes=0;b.dismissal=""; });
      bowlingStats[currentInnings] = {};
      fallWickets[currentInnings] = [];
      partnerships[currentInnings] = [];
      partnershipRuns = 0; partnershipBalls = 0;
      strip.innerHTML = "";
      setScoringEnabled(true);
      resultBanner.style.display = "none";
      updateEverything();
    });

    popup.addEventListener("click", (e)=>{ if(e.target === popup) popup.style.display="none"; });

    /* ====== initial UI enable ====== */
    setScoringEnabled(true);
    updateEverything();

  }); // DOMContentLoaded end
  </script>
</body>
</html>
