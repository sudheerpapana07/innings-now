<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cricket Scorecard - Mini Crex</title>

  <style>
    /* Basic reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: #050816;
      color: #f8fafc;
      display: flex;
      justify-content: center;
      padding: 16px;
    }

    .app {
      width: 100%;
      max-width: 900px;
      background: radial-gradient(circle at top, #111827 0, #020617 55%);
      border-radius: 24px;
      padding: 16px 16px 24px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.7);
    }

    /* Header */
    .app-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 16px;
      font-size: 14px;
      color: #e5e7eb;
      flex-wrap: wrap;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #22c55e;
      box-shadow: 0 0 10px rgba(34, 197, 94, 0.8);
    }

    .status-text {
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #22c55e;
    }

    .match-info {
      margin-left: 8px;
      font-weight: 500;
      color: #cbd5f5;
    }

    /* Top match card (only batting team) */
    .match-card {
      background: #020617;
      border-radius: 20px;
      padding: 14px;
      box-shadow: 0 8px 25px rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.2);
      display: grid;
      gap: 6px;
    }

    .team-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .team-name {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
      color: #e5e7eb;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .team-score {
      font-weight: 700;
      font-size: 20px;
      color: #f9fafb;
    }

    .overs {
      font-size: 12px;
      margin-left: 4px;
      color: #9ca3af;
    }

    .mini-ball-strip {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 4px;
    }

    .mini-ball-chip {
      min-width: 18px;
      text-align: center;
      padding: 2px 4px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.95);
      font-size: 11px;
      color: #e5e7eb;
    }

    .match-summary {
      margin-top: 4px;
      font-size: 13px;
      color: #f97316;
      font-weight: 500;
    }

    .info-row {
      margin-top: 4px;
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: #9ca3af;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.5);
      gap: 4px;
    }

    .pill-label {
      text-transform: uppercase;
      letter-spacing: 0.07em;
      font-size: 10px;
      color: #9ca3af;
    }

    .pill-value {
      font-weight: 600;
      font-size: 11px;
      color: #e5e7eb;
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 8px;
      margin-top: 16px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .tab {
      flex: 1;
      min-width: 120px;
      padding: 8px 0;
      border-radius: 999px;
      border: none;
      background: rgba(15, 23, 42, 0.85);
      color: #9ca3af;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .tab.active {
      background: linear-gradient(135deg, #22c55e, #0ea5e9);
      color: #020617;
      box-shadow: 0 8px 20px rgba(34, 197, 94, 0.5);
    }

    .tab-content {
      background: rgba(15, 23, 42, 0.85);
      border-radius: 20px;
      padding: 12px;
      border: 1px solid rgba(148, 163, 184, 0.25);
      margin-top: 4px;
    }

    .tab-panel {
      display: none;
    }

    .tab-panel.active {
      display: block;
    }

    .section-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
      color: #e5e7eb;
    }

    .section-subtitle {
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 6px;
    }

    /* Inputs */
    .input-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
      margin-bottom: 4px;
    }

    .field {
      flex: 1;
      min-width: 120px;
    }

    .field-label {
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 2px;
    }

    .text-input {
      width: 100%;
      background: rgba(15, 23, 42, 0.95);
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: #e5e7eb;
      padding: 4px 8px;
      font-size: 11px;
      outline: none;
    }

    .text-input::placeholder {
      color: #6b7280;
    }

    select.text-input {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
    }

    .mini-btn {
      padding: 4px 8px;
      border-radius: 999px;
      border: none;
      font-size: 11px;
      cursor: pointer;
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      border: 1px solid rgba(148, 163, 184, 0.8);
    }

    /* Score buttons */
    .controls {
      margin-bottom: 10px;
      padding: 8px 10px;
      border-radius: 14px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px dashed rgba(148, 163, 184, 0.4);
    }

    .controls-title {
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 6px;
    }

    .controls-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .score-btn {
      flex: 1;
      min-width: 60px;
      padding: 6px 8px;
      border-radius: 999px;
      border: none;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      background: rgba(15, 23, 42, 0.95);
      color: #e5e7eb;
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.9);
      transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.1s ease;
    }

    .score-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 14px rgba(15, 23, 42, 0.9);
    }

    .score-btn:active {
      transform: translateY(0);
      box-shadow: 0 2px 6px rgba(15, 23, 42, 0.9);
    }

    .score-btn.primary {
      background: linear-gradient(135deg, #22c55e, #0ea5e9);
      color: #020617;
    }

    .score-btn.danger {
      background: linear-gradient(135deg, #f97316, #ef4444);
      color: #020617;
    }

    .score-btn.reset {
      background: rgba(15, 23, 42, 0.9);
      color: #9ca3af;
      flex: none;
    }

    /* Match-info XI grid */
    .match-info-xi-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
      margin-top: 6px;
    }

    @media (min-width: 720px) {
      .match-info-xi-grid {
        grid-template-columns: 1fr 1fr;
      }
    }

    .xi-card {
      background: rgba(15, 23, 42, 0.85);
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      padding: 8px;
    }

    .xi-card-header {
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 4px;
      color: #e5e7eb;
    }

    .players-box {
      margin-top: 4px;
      max-height: 220px;
      overflow-y: auto;
      padding: 4px 6px;
      border-radius: 10px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(55, 65, 81, 0.7);
    }

    .player-input-row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 4px;
    }

    .player-index {
      font-size: 11px;
      color: #9ca3af;
      width: 16px;
      text-align: right;
    }

    /* Innings switch & scorecard */
    .innings-switch {
      display: flex;
      gap: 6px;
      margin-bottom: 8px;
      flex-wrap: wrap;
      align-items: center;
    }

    .innings-switch-label {
      font-size: 12px;
      color: #9ca3af;
    }

    .innings-btn {
      padding: 4px 10px;
      border-radius: 999px;
      border: none;
      font-size: 12px;
      cursor: pointer;
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      border: 1px solid rgba(148, 163, 184, 0.8);
    }

    .innings-btn.active {
      background: linear-gradient(135deg, #22c55e, #0ea5e9);
      color: #020617;
      border-color: transparent;
    }

    .innings-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
      margin-top: 8px;
    }

    .innings-block {
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(15, 23, 42, 0.9);
      padding: 8px;
    }

    @media (min-width: 720px) {
      .innings-grid {
        grid-template-columns: 1fr 1fr;
      }
      .innings-block {
        display: block !important;
      }
    }

    @media (max-width: 719px) {
      .innings-block {
        display: none;
      }
      .innings-block.is-current {
        display: block;
      }
    }

    .innings-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 6px;
      color: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
    }

    .innings-tag {
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(96, 165, 250, 0.7);
      color: #bfdbfe;
      background: rgba(15, 23, 42, 0.9);
    }

    .innings-subtitle {
      font-size: 11px;
      font-weight: 500;
      margin-top: 6px;
      margin-bottom: 4px;
      color: #9ca3af;
    }

    .table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
    }

    .table thead {
      background: rgba(15, 23, 42, 0.9);
    }

    .table th,
    .table td {
      padding: 5px 4px;
      text-align: right;
    }

    .table th:first-child,
    .table td:first-child {
      text-align: left;
    }

    .table th {
      font-weight: 500;
      color: #9ca3af;
    }

    .table tbody tr:nth-child(even) {
      background: rgba(15, 23, 42, 0.7);
    }

    .table tbody tr:nth-child(odd) {
      background: rgba(15, 23, 42, 0.45);
    }

    .striker-dot {
      color: #22c55e;
      font-size: 10px;
      margin-right: 4px;
    }

    .non-striker-dot {
      color: #38bdf8;
      font-size: 10px;
      margin-right: 4px;
    }

    .out-text {
      color: #f97316;
      font-size: 9px;
      margin-left: 4px;
      text-transform: uppercase;
    }

    .dismissal-info {
      font-size: 10px;
      color: #9ca3af;
      margin-top: 2px;
    }

    /* Ball timeline (live tab) */
    .ball-timeline {
      margin-top: 8px;
      padding-top: 6px;
      border-top: 1px dashed rgba(148, 163, 184, 0.4);
    }

    .timeline-title {
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 4px;
    }

    .timeline-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      align-items: center;
    }

    .ball-chip {
      min-width: 18px;
      text-align: center;
      padding: 2px 4px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.95);
      font-size: 11px;
      color: #e5e7eb;
    }

    .over-separator {
      padding: 0 4px;
      font-size: 11px;
      color: #6b7280;
    }

    /* Live mini cards */
    .live-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
      margin-top: 8px;
    }

    @media (min-width: 720px) {
      .live-grid {
        grid-template-columns: 2fr 1fr;
      }
    }

    .live-card {
      background: rgba(15, 23, 42, 0.9);
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      padding: 8px;
    }

    .live-card-title {
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 4px;
      color: #e5e7eb;
    }

    .live-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
    }

    .live-table th,
    .live-table td {
      padding: 4px 4px;
      text-align: right;
    }

    .live-table th:first-child,
    .live-table td:first-child {
      text-align: left;
    }

    .live-table th {
      font-weight: 500;
      color: #9ca3af;
    }

    /* Dismissal overlay */
    .dismissal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.85);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 16px;
      z-index: 50;
    }

    .dismissal-card {
      width: 100%;
      max-width: 360px;
      background: #020617;
      border-radius: 18px;
      padding: 12px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.8);
    }

    .dismissal-header {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 6px;
      color: #e5e7eb;
    }

    .dismissal-sub {
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 8px;
    }

    .dismissal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 6px;
      margin-top: 8px;
    }

    /* Emoji toast */
    .event-toast {
      position: fixed;
      left: 50%;
      bottom: 40px;
      transform: translateX(-50%) translateY(20px);
      padding: 8px 16px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(148, 163, 184, 0.7);
      font-size: 20px;
      font-weight: 700;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease, transform 0.2s ease;
      z-index: 60;
    }

    .event-toast.visible {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- Header: match name -->
    <header class="app-header">
      <div class="status-dot"></div>
      <span class="status-text">Live</span>
      <span class="match-info">
        <span class="team-a-name">TEAM A</span> vs <span class="team-b-name">TEAM B</span>
      </span>
    </header>

    <!-- Top card: only batting team + ball strip -->
    <section class="match-card">
      <div class="team-row">
        <div class="team-name">
          <span id="current-team-name">TEAM A</span>
        </div>
        <div class="team-score">
          <span id="current-runs">0</span>-<span id="current-wkts">0</span>
          <span class="overs">(<span id="current-overs">0.0</span>)</span>
        </div>
      </div>

      <div class="mini-ball-strip" id="mini-ball-strip">
        <!-- last balls -->
      </div>

      <div class="match-summary" id="match-summary">
        Current innings: TEAM A • 0/0 (0.0)
      </div>
      <div class="info-row">
        <span class="pill">
          <span class="pill-label">CRR</span>
          <span class="pill-value" id="current-rr">0.0</span>
        </span>
        <span class="pill">
          <span class="pill-label" id="info-right-label">STATUS</span>
          <span class="pill-value" id="info-right-value">1st innings</span>
        </span>
      </div>
    </section>

    <!-- Tabs -->
    <nav class="tabs">
      <button class="tab active" data-tab="match-info">Match info</button>
      <button class="tab" data-tab="live">Live</button>
      <button class="tab" data-tab="scorecard">Scorecard</button>
    </nav>

    <main class="tab-content">
      <!-- MATCH INFO TAB -->
      <section id="match-info" class="tab-panel active">
        <div class="section-title">Teams</div>
        <div class="section-subtitle">Edit team names and playing XI.</div>

        <div class="input-row">
          <div class="field">
            <div class="field-label">Team A name</div>
            <input id="teamA-name-input" class="text-input" placeholder="Team A" />
          </div>
          <div class="field">
            <div class="field-label">Team B name</div>
            <input id="teamB-name-input" class="text-input" placeholder="Team B" />
          </div>
          <button class="score-btn reset" id="apply-teams-btn">Apply</button>
        </div>

        <div class="match-info-xi-grid">
          <div class="xi-card">
            <div class="xi-card-header">Team A Playing XI</div>
            <div class="players-box" id="teamA-players-box"></div>
            <div style="margin-top:6px; text-align:right;">
              <button class="mini-btn" id="apply-teamA-players-btn">Apply Team A XI</button>
            </div>
          </div>

          <div class="xi-card">
            <div class="xi-card-header">Team B Playing XI</div>
            <div class="players-box" id="teamB-players-box"></div>
            <div style="margin-top:6px; text-align:right;">
              <button class="mini-btn" id="apply-teamB-players-btn">Apply Team B XI</button>
            </div>
          </div>
        </div>
      </section>

      <!-- LIVE TAB -->
      <section id="live" class="tab-panel">
        <div class="section-title">Live</div>
        <div class="section-subtitle">
          Only live timeline + current batters + current bowler (like Crex "Live" tab).
        </div>

        <div class="innings-switch">
          <span class="innings-switch-label">Current batting:</span>
          <button class="innings-btn active" data-innings="A" id="inningsA-btn">Team A</button>
          <button class="innings-btn" data-innings="B" id="inningsB-btn">Team B</button>
        </div>

        <div class="controls">
          <div class="controls-title" id="controls-title">Live score controls (Team A innings)</div>
          <div class="controls-row">
            <button class="score-btn primary" data-runs="0">Dot</button>
            <button class="score-btn primary" data-runs="1">+1</button>
            <button class="score-btn primary" data-runs="2">+2</button>
            <button class="score-btn primary" data-runs="3">+3</button>
            <button class="score-btn primary" data-runs="4">+4</button>
            <button class="score-btn primary" data-runs="6">+6</button>
            <button class="score-btn danger" id="wicket-btn">W</button>
            <button class="score-btn reset" id="reset-innings-btn">Reset innings</button>
          </div>

          <div class="controls-title" style="margin-top:6px;">Current bowler (this innings)</div>
          <div class="input-row">
            <div class="field">
              <select id="current-bowler-select" class="text-input"></select>
            </div>
          </div>
        </div>

        <div class="live-grid">
          <div class="live-card">
            <div class="live-card-title">Current batters</div>
            <table class="live-table">
              <thead>
                <tr>
                  <th>Batter</th>
                  <th>R</th>
                  <th>B</th>
                  <th>SR</th>
                </tr>
              </thead>
              <tbody id="live-batters-body"></tbody>
            </table>
          </div>

          <div class="live-card">
            <div class="live-card-title">Current bowler</div>
            <table class="live-table">
              <thead>
                <tr>
                  <th>Bowler</th>
                  <th>O</th>
                  <th>R</th>
                  <th>W</th>
                  <th>Econ</th>
                </tr>
              </thead>
              <tbody id="live-bowler-body"></tbody>
            </table>
          </div>
        </div>

        <div class="ball-timeline">
          <div class="timeline-title">Ball timeline (current innings)</div>
          <div class="timeline-row" id="ball-timeline-row"></div>
        </div>
      </section>

      <!-- SCORECARD TAB -->
      <section id="scorecard" class="tab-panel">
        <div class="section-title">Scorecard</div>
        <div class="section-subtitle">
          Full scorecard for both innings – like Crex "Scorecard".
        </div>

        <div class="innings-grid">
          <div class="innings-block" id="inningsA-block">
            <div class="innings-title" id="inningsA-title">
              Team A Innings • 0/0 (0.0)
              <span class="innings-tag">1st Innings</span>
            </div>
            <table class="table">
              <thead>
                <tr>
                  <th>Batter</th>
                  <th>R</th>
                  <th>B</th>
                  <th>4s</th>
                  <th>6s</th>
                  <th>SR</th>
                </tr>
              </thead>
              <tbody id="teamA-batters-body"></tbody>
            </table>

            <div class="innings-subtitle" id="inningsA-bowling-title">Bowling – Team B</div>
            <table class="table">
              <thead>
                <tr>
                  <th>Bowler</th>
                  <th>O</th>
                  <th>M</th>
                  <th>R</th>
                  <th>W</th>
                  <th>Econ</th>
                </tr>
              </thead>
              <tbody id="teamA-bowling-body"></tbody>
            </table>
          </div>

          <div class="innings-block" id="inningsB-block">
            <div class="innings-title" id="inningsB-title">
              Team B Innings • 0/0 (0.0)
              <span class="innings-tag">2nd Innings</span>
            </div>
            <table class="table">
              <thead>
                <tr>
                  <th>Batter</th>
                  <th>R</th>
                  <th>B</th>
                  <th>4s</th>
                  <th>6s</th>
                  <th>SR</th>
                </tr>
              </thead>
              <tbody id="teamB-batters-body"></tbody>
            </table>

            <div class="innings-subtitle" id="inningsB-bowling-title">Bowling – Team A</div>
            <table class="table">
              <thead>
                <tr>
                  <th>Bowler</th>
                  <th>O</th>
                  <th>M</th>
                  <th>R</th>
                  <th>W</th>
                  <th>Econ</th>
                </tr>
              </thead>
              <tbody id="teamB-bowling-body"></tbody>
            </table>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Dismissal overlay (for Wicket button) -->
  <div class="dismissal-overlay" id="dismissal-overlay">
    <div class="dismissal-card">
      <div class="dismissal-header">Wicket details</div>
      <div class="dismissal-sub">
        Example: <code>c Rahul b Bumrah</code>, <code>lbw b Siraj</code>, etc.
      </div>
      <div class="field">
        <div class="field-label">How out?</div>
        <input id="dismissal-text-input" class="text-input" />
      </div>
      <div class="dismissal-actions">
        <button class="mini-btn" id="dismissal-cancel-btn">Cancel</button>
        <button class="score-btn primary" id="dismissal-save-btn" style="flex:none;min-width:80px;">Save</button>
      </div>
    </div>
  </div>

  <!-- Emoji toast -->
  <div class="event-toast" id="event-toast"></div>

  <script>
    const MAX_PLAYERS = 11;
    const MAX_OVERS = 20;

    const teams = {
      A: "TEAM A",
      B: "TEAM B"
    };

    function makeEmptyInnings() {
      const batters = [];
      for (let i = 0; i < MAX_PLAYERS; i++) {
        batters.push({
          name: "Player " + (i + 1),
          runs: 0,
          balls: 0,
          fours: 0,
          sixes: 0,
          out: false,
          dismissal: ""
        });
      }
      return {
        runs: 0,
        wickets: 0,
        balls: 0,
        batters: batters,
        strikerIndex: 0,
        nonStrikerIndex: 1,
        nextBatterIndex: 2,
        ballEvents: []
      };
    }

    function makeEmptyBowling(names) {
      return names.map(function(name) {
        return {
          name: name,
          balls: 0,
          overs: 0,
          maidens: 0,
          runs: 0,
          wickets: 0,
          currentOverRuns: 0
        };
      });
    }

    const innings = {
      A: makeEmptyInnings(),
      B: makeEmptyInnings()
    };

    let bowlingFigures = {
      A: makeEmptyBowling(innings.B.batters.map(b => b.name)),
      B: makeEmptyBowling(innings.A.batters.map(b => b.name))
    };

    let currentBowlerIndex = { A: 0, B: 0 };
    let currentInningsKey = "A";

    /* DOM */
    const teamNameSpansA = document.querySelectorAll(".team-a-name");
    const teamNameSpansB = document.querySelectorAll(".team-b-name");

    const currentTeamNameEl = document.getElementById("current-team-name");
    const currentRunsEl = document.getElementById("current-runs");
    const currentWktsEl = document.getElementById("current-wkts");
    const currentOversEl = document.getElementById("current-overs");
    const miniBallStrip = document.getElementById("mini-ball-strip");

    const matchSummaryEl = document.getElementById("match-summary");
    const crrEl = document.getElementById("current-rr");
    const infoRightLabelEl = document.getElementById("info-right-label");
    const infoRightValueEl = document.getElementById("info-right-value");

    const teamANameInput = document.getElementById("teamA-name-input");
    const teamBNameInput = document.getElementById("teamB-name-input");
    const applyTeamsBtn = document.getElementById("apply-teams-btn");

    const teamAPlayersBox = document.getElementById("teamA-players-box");
    const teamBPlayersBox = document.getElementById("teamB-players-box");
    const applyTeamAPlayersBtn = document.getElementById("apply-teamA-players-btn");
    const applyTeamBPlayersBtn = document.getElementById("apply-teamB-players-btn");

    const inningsABtn = document.getElementById("inningsA-btn");
    const inningsBBtn = document.getElementById("inningsB-btn");
    const controlsTitleEl = document.getElementById("controls-title");
    const resetInningsBtn = document.getElementById("reset-innings-btn");
    const wicketBtn = document.getElementById("wicket-btn");

    const currentBowlerSelect = document.getElementById("current-bowler-select");

    const inningsABlock = document.getElementById("inningsA-block");
    const inningsBBlock = document.getElementById("inningsB-block");
    const inningsATitleEl = document.getElementById("inningsA-title");
    const inningsBTitleEl = document.getElementById("inningsB-title");
    const inningsABowlingTitleEl = document.getElementById("inningsA-bowling-title");
    const inningsBBowlingTitleEl = document.getElementById("inningsB-bowling-title");
    const inningsABody = document.getElementById("teamA-batters-body");
    const inningsBBody = document.getElementById("teamB-batters-body");
    const inningsABowlingBody = document.getElementById("teamA-bowling-body");
    const inningsBBowlingBody = document.getElementById("teamB-bowling-body");

    const ballTimelineRow = document.getElementById("ball-timeline-row");
    const liveBattersBody = document.getElementById("live-batters-body");
    const liveBowlerBody = document.getElementById("live-bowler-body");

    const dismissalOverlay = document.getElementById("dismissal-overlay");
    const dismissalInput = document.getElementById("dismissal-text-input");
    const dismissalSaveBtn = document.getElementById("dismissal-save-btn");
    const dismissalCancelBtn = document.getElementById("dismissal-cancel-btn");

    const eventToast = document.getElementById("event-toast");

    let pendingDismissal = null;

    /* Helpers */
    function formatOvers(balls) {
      const overs = Math.floor(balls / 6);
      const ballsPart = balls % 6;
      return overs + "." + ballsPart;
    }

    function calculateCRR(runs, balls) {
      if (balls === 0) return "0.0";
      const overs = balls / 6;
      return (runs / overs).toFixed(1);
    }

    function formatEcon(runs, balls) {
      if (balls === 0) return "0.0";
      const overs = balls / 6;
      return (runs / overs).toFixed(1);
    }

    function updateTeamNamesUI() {
      teamNameSpansA.forEach(el => el.textContent = teams.A);
      teamNameSpansB.forEach(el => el.textContent = teams.B);
      inningsABowlingTitleEl.textContent = "Bowling – " + teams.B;
      inningsBBowlingTitleEl.textContent = "Bowling – " + teams.A;
    }

    function renderBattersTable(teamKey) {
      const inn = innings[teamKey];
      const tbody = teamKey === "A" ? inningsABody : inningsBBody;
      tbody.innerHTML = "";

      inn.batters.forEach((batter, idx) => {
        const sr = batter.balls === 0 ? "0.0" : ((batter.runs / batter.balls) * 100).toFixed(1);
        let nameHtml = batter.name;

        if (teamKey === currentInningsKey && !batter.out) {
          if (idx === inn.strikerIndex) {
            nameHtml = '<span class="striker-dot">●</span>' + batter.name;
          } else if (idx === inn.nonStrikerIndex) {
            nameHtml = '<span class="non-striker-dot">◯</span>' + batter.name;
          }
        }

        if (batter.out) {
          nameHtml += '<span class="out-text">out</span>';
        }

        const row = document.createElement("tr");
        const dismissalHtml = batter.dismissal
          ? '<div class="dismissal-info">' + batter.dismissal + '</div>'
          : "";
        row.innerHTML =
          "<td>" + nameHtml + dismissalHtml + "</td>" +
          "<td>" + batter.runs + "</td>" +
          "<td>" + batter.balls + "</td>" +
          "<td>" + batter.fours + "</td>" +
          "<td>" + batter.sixes + "</td>" +
          "<td>" + sr + "</td>";
        tbody.appendChild(row);
      });
    }

    function renderBowlingTable(inningsKey) {
      const bowlers = bowlingFigures[inningsKey];
      const tbody = inningsKey === "A" ? inningsABowlingBody : inningsBBowlingBody;
      tbody.innerHTML = "";

      bowlers.forEach(bowler => {
        const oversText = formatOvers(bowler.balls);
        const econ = formatEcon(bowler.runs, bowler.balls);
        const row = document.createElement("tr");
        row.innerHTML =
          "<td>" + bowler.name + "</td>" +
          "<td>" + oversText + "</td>" +
          "<td>" + bowler.maidens + "</td>" +
          "<td>" + bowler.runs + "</td>" +
          "<td>" + bowler.wickets + "</td>" +
          "<td>" + econ + "</td>";
        tbody.appendChild(row);
      });
    }

    function renderTimeline() {
      const inn = innings[currentInningsKey];
      ballTimelineRow.innerHTML = "";
      inn.ballEvents.forEach((symbol, idx) => {
        const span = document.createElement("span");
        span.className = "ball-chip";
        span.textContent = symbol;
        ballTimelineRow.appendChild(span);

        if ((idx + 1) % 6 === 0 && idx !== inn.ballEvents.length - 1) {
          const sep = document.createElement("span");
          sep.className = "over-separator";
          sep.textContent = "|";
          ballTimelineRow.appendChild(sep);
        }
      });
    }

    function renderMiniStrip() {
      const inn = innings[currentInningsKey];
      miniBallStrip.innerHTML = "";
      const events = inn.ballEvents.slice(-12);
      events.forEach(symbol => {
        const span = document.createElement("span");
        span.className = "mini-ball-chip";
        span.textContent = symbol;
        miniBallStrip.appendChild(span);
      });
    }

    function renderLiveBatters() {
      const inn = innings[currentInningsKey];
      liveBattersBody.innerHTML = "";

      const striker = inn.batters[inn.strikerIndex];
      const nonStriker = inn.batters[inn.nonStrikerIndex];

      function addRow(prefix, batter) {
        if (!batter) return;
        const sr = batter.balls === 0 ? "0.0" : ((batter.runs / batter.balls) * 100).toFixed(1);
        const row = document.createElement("tr");
        row.innerHTML =
          "<td>" + prefix + " " + batter.name + "</td>" +
          "<td>" + batter.runs + "</td>" +
          "<td>" + batter.balls + "</td>" +
          "<td>" + sr + "</td>";
        liveBattersBody.appendChild(row);
      }

      addRow("●", striker);
      addRow("◯", nonStriker);
    }

    function renderLiveBowler() {
      const bowlers = bowlingFigures[currentInningsKey];
      const idx = currentBowlerIndex[currentInningsKey] || 0;
      const bowler = bowlers[idx];
      liveBowlerBody.innerHTML = "";

      const row = document.createElement("tr");
      const econ = formatEcon(bowler.runs, bowler.balls);
      row.innerHTML =
        "<td>" + bowler.name + "</td>" +
        "<td>" + formatOvers(bowler.balls) + "</td>" +
        "<td>" + bowler.runs + "</td>" +
        "<td>" + bowler.wickets + "</td>" +
        "<td>" + econ + "</td>";
      liveBowlerBody.appendChild(row);
    }

    function updateMatchCard() {
      const inn = innings[currentInningsKey];
      const teamName = currentInningsKey === "A" ? teams.A : teams.B;

      currentTeamNameEl.textContent = teamName;
      currentRunsEl.textContent = inn.runs;
      currentWktsEl.textContent = inn.wickets;
      currentOversEl.textContent = formatOvers(inn.balls);
    }

    function updateInningsTitles() {
      const innA = innings.A;
      const innB = innings.B;
      inningsATitleEl.childNodes[0].nodeValue =
        teams.A + " Innings • " + innA.runs + "/" + innA.wickets + " (" + formatOvers(innA.balls) + ") ";
      inningsBTitleEl.childNodes[0].nodeValue =
        teams.B + " Innings • " + innB.runs + "/" + innB.wickets + " (" + formatOvers(innB.balls) + ") ";
    }

    function updateInningsBlockCurrentClass() {
      inningsABlock.classList.toggle("is-current", currentInningsKey === "A");
      inningsBBlock.classList.toggle("is-current", currentInningsKey === "B");
    }

    function buildBowlerSelectOptions() {
      const bowlingTeamKey = currentInningsKey === "A" ? "B" : "A";
      const sourceBatters = innings[bowlingTeamKey].batters;

      bowlingFigures[currentInningsKey].forEach((bowler, i) => {
        bowler.name = sourceBatters[i].name;
      });

      const idx = currentBowlerIndex[currentInningsKey] || 0;
      currentBowlerSelect.innerHTML = "";

      bowlingFigures[currentInningsKey].forEach((bowler, i) => {
        const opt = document.createElement("option");
        opt.value = i;
        opt.textContent = bowler.name;
        if (i === idx) opt.selected = true;
        currentBowlerSelect.appendChild(opt);
      });
    }

    function updateControlsTitle() {
      const name = currentInningsKey === "A" ? teams.A : teams.B;
      controlsTitleEl.textContent = "Live score controls (" + name + " innings)";
    }

    function updateSummaryAndInfoChips() {
      const inn = innings[currentInningsKey];
      const teamName = currentInningsKey === "A" ? teams.A : teams.B;
      const oversText = formatOvers(inn.balls);
      let label = "";
      let value = "";

      if (currentInningsKey === "A") {
        matchSummaryEl.textContent =
          "1st innings: " + teamName + " • " + inn.runs + "/" + inn.wickets + " (" + oversText + ")";
        label = "STATUS";
        value = "1st innings";
      } else {
        const firstInn = innings.A;
        if (firstInn.balls === 0 && firstInn.runs === 0) {
          matchSummaryEl.textContent =
            "Current innings: " + teamName + " • " + inn.runs + "/" + inn.wickets + " (" + oversText + ")";
          label = "TARGET";
          value = "—";
        } else {
          const target = firstInn.runs + 1;
          const totalBalls = MAX_OVERS * 6;
          const ballsLeft = totalBalls - inn.balls;
          const runsNeeded = target - inn.runs;

          if (inn.runs >= target) {
            const wicketsInHand = 10 - inn.wickets;
            matchSummaryEl.textContent =
              teamName + " won by " + wicketsInHand + " wicket(s)";
            label = "RESULT";
            value = "Chase completed";
          } else if (inn.balls >= totalBalls || inn.wickets >= 10) {
            const margin = firstInn.runs - inn.runs;
            matchSummaryEl.textContent =
              teams.A + " won by " + margin + " run(s)";
            label = "TARGET";
            value = String(target);
          } else {
            const rrr = (runsNeeded > 0 && ballsLeft > 0)
              ? (runsNeeded / (ballsLeft / 6)).toFixed(2)
              : "0.0";
            matchSummaryEl.textContent =
              teamName + " need " + runsNeeded + " runs from " + ballsLeft + " balls";
            label = "TARGET / RRR";
            value = target + " / " + rrr;
          }
        }
      }

      crrEl.textContent = calculateCRR(inn.runs, inn.balls);
      infoRightLabelEl.textContent = label;
      infoRightValueEl.textContent = value;
    }

    function buildPlayerInputs() {
      teamAPlayersBox.innerHTML = "";
      teamBPlayersBox.innerHTML = "";

      innings.A.batters.forEach((batter, i) => {
        const row = document.createElement("div");
        row.className = "player-input-row";
        row.innerHTML =
          '<span class="player-index">' + (i + 1) + '.</span>' +
          '<input class="text-input" id="teamA-player-input-' + i + '" value="' + batter.name + '" />';
        teamAPlayersBox.appendChild(row);
      });

      innings.B.batters.forEach((batter, i) => {
        const row = document.createElement("div");
        row.className = "player-input-row";
        row.innerHTML =
          '<span class="player-index">' + (i + 1) + '.</span>' +
          '<input class="text-input" id="teamB-player-input-' + i + '" value="' + batter.name + '" />';
        teamBPlayersBox.appendChild(row);
      });
    }

    function showEventToast(type) {
      let text = "";
      let emoji = "";
      if (type === "FOUR") { text = "FOUR!"; emoji = "4️⃣"; }
      else if (type === "SIX") { text = "SIX!"; emoji = "6️⃣"; }
      else if (type === "WICKET") { text = "WICKET!"; emoji = "❌"; }
      else { text = type; emoji = ""; }

      eventToast.textContent = emoji + " " + text;
      eventToast.classList.add("visible");
      clearTimeout(eventToast._timeout);
      eventToast._timeout = setTimeout(() => {
        eventToast.classList.remove("visible");
      }, 900);
    }

    function updateUI() {
      updateTeamNamesUI();
      updateMatchCard();
      updateInningsTitles();
      renderBattersTable("A");
      renderBattersTable("B");
      renderBowlingTable("A");
      renderBowlingTable("B");
      renderTimeline();
      renderMiniStrip();
      renderLiveBatters();
      renderLiveBowler();
      updateControlsTitle();
      updateInningsBlockCurrentClass();
      buildBowlerSelectOptions();
      updateSummaryAndInfoChips();
    }

    /* STRIKE + BALL LOGIC */

    function swapStrike(inn) {
      const temp = inn.strikerIndex;
      inn.strikerIndex = inn.nonStrikerIndex;
      inn.nonStrikerIndex = temp;
    }

    function addBall(runsScored, isWicket, dismissalText) {
      const inn = innings[currentInningsKey];
      const bowlers = bowlingFigures[currentInningsKey];
      const bowlerIdx = currentBowlerIndex[currentInningsKey] || 0;
      const bowler = bowlers[bowlerIdx];
      const totalBalls = MAX_OVERS * 6;

      if (inn.balls >= totalBalls) return;
      if (inn.wickets >= 10) return;

      inn.balls += 1;
      inn.runs += runsScored;

      const striker = inn.batters[inn.strikerIndex];
      if (!striker.out) {
        striker.balls += 1;
        striker.runs += runsScored;
        if (runsScored === 4) striker.fours += 1;
        if (runsScored === 6) striker.sixes += 1;
      }

      let symbol;
      if (isWicket) symbol = "W";
      else if (runsScored === 0) symbol = ".";
      else symbol = String(runsScored);
      inn.ballEvents.push(symbol);

      bowler.balls += 1;
      bowler.runs += runsScored;
      bowler.currentOverRuns += runsScored;
      if (isWicket) bowler.wickets += 1;

      if (bowler.balls % 6 === 0) {
        bowler.overs = bowler.balls / 6;
        if (bowler.currentOverRuns === 0) {
          bowler.maidens += 1;
        }
        bowler.currentOverRuns = 0;
      }

      if (isWicket) {
        striker.out = true;
        if (dismissalText) {
          striker.dismissal = dismissalText;
        } else {
          striker.dismissal = "out";
        }
        inn.wickets += 1;
        if (inn.nextBatterIndex < MAX_PLAYERS) {
          inn.strikerIndex = inn.nextBatterIndex;
          inn.nextBatterIndex += 1;
        }
        showEventToast("WICKET");
      } else {
        if (runsScored === 4) showEventToast("FOUR");
        if (runsScored === 6) showEventToast("SIX");

        if (runsScored % 2 === 1) {
          swapStrike(inn);
        }
      }

      if (inn.balls % 6 === 0) {
        swapStrike(inn);
      }

      updateUI();
    }

    /* EVENTS */

    // Run buttons
    document.querySelectorAll(".score-btn.primary").forEach(btn => {
      btn.addEventListener("click", () => {
        const runs = parseInt(btn.dataset.runs, 10);
        if (!isNaN(runs)) {
          addBall(runs, false, "");
        }
      });
    });

    // Wicket: open dismissal overlay
    wicketBtn.addEventListener("click", () => {
      const inn = innings[currentInningsKey];
      const striker = inn.batters[inn.strikerIndex];
      const bowlers = bowlingFigures[currentInningsKey];
      const bowlerIdx = currentBowlerIndex[currentInningsKey] || 0;
      const bowler = bowlers[bowlerIdx];

      const defaultText = "b " + bowler.name;
      dismissalInput.value = defaultText;
      pendingDismissal = { inningsKey: currentInningsKey };
      dismissalOverlay.style.display = "flex";
    });

    dismissalSaveBtn.addEventListener("click", () => {
      if (!pendingDismissal) return;
      const text = dismissalInput.value.trim();
      currentInningsKey = pendingDismissal.inningsKey;
      dismissalOverlay.style.display = "none";
      pendingDismissal = null;
      addBall(0, true, text);
    });

    dismissalCancelBtn.addEventListener("click", () => {
      pendingDismissal = null;
      dismissalOverlay.style.display = "none";
    });

    // Reset current innings
    resetInningsBtn.addEventListener("click", () => {
      const key = currentInningsKey;
      const inn = innings[key];
      const bowlers = bowlingFigures[key];

      inn.runs = 0;
      inn.wickets = 0;
      inn.balls = 0;
      inn.ballEvents = [];
      inn.strikerIndex = 0;
      inn.nonStrikerIndex = 1;
      inn.nextBatterIndex = 2;

      inn.batters.forEach(batter => {
        batter.runs = 0;
        batter.balls = 0;
        batter.fours = 0;
        batter.sixes = 0;
        batter.out = false;
        batter.dismissal = "";
      });

      bowlers.forEach(bowler => {
        bowler.balls = 0;
        bowler.overs = 0;
        bowler.maidens = 0;
        bowler.runs = 0;
        bowler.wickets = 0;
        bowler.currentOverRuns = 0;
      });

      updateUI();
    });

    // Apply team names
    applyTeamsBtn.addEventListener("click", () => {
      const aVal = teamANameInput.value.trim();
      const bVal = teamBNameInput.value.trim();
      if (aVal) teams.A = aVal;
      if (bVal) teams.B = bVal;
      updateUI();
    });

    // Apply XI changes
    applyTeamAPlayersBtn.addEventListener("click", () => {
      innings.A.batters.forEach((batter, i) => {
        const input = document.getElementById("teamA-player-input-" + i);
        if (input && input.value.trim()) {
          batter.name = input.value.trim();
        }
      });

      bowlingFigures.B.forEach((bowler, i) => {
        bowler.name = innings.A.batters[i].name;
      });

      updateUI();
    });

    applyTeamBPlayersBtn.addEventListener("click", () => {
      innings.B.batters.forEach((batter, i) => {
        const input = document.getElementById("teamB-player-input-" + i);
        if (input && input.value.trim()) {
          batter.name = input.value.trim();
        }
      });

      bowlingFigures.A.forEach((bowler, i) => {
        bowler.name = innings.B.batters[i].name;
      });

      updateUI();
    });

    // Switch innings
    inningsABtn.addEventListener("click", () => {
      currentInningsKey = "A";
      inningsABtn.classList.add("active");
      inningsBBtn.classList.remove("active");
      updateUI();
    });

    inningsBBtn.addEventListener("click", () => {
      currentInningsKey = "B";
      inningsBBtn.classList.add("active");
      inningsABtn.classList.remove("active");
      updateUI();
    });

    // Change current bowler
    currentBowlerSelect.addEventListener("change", () => {
      currentBowlerIndex[currentInningsKey] = parseInt(currentBowlerSelect.value, 10);
      updateUI();
    });

    // Tabs
    const tabs = document.querySelectorAll(".tab");
    const panels = document.querySelectorAll(".tab-panel");

    tabs.forEach(tab => {
      tab.addEventListener("click", () => {
        tabs.forEach(t => t.classList.remove("active"));
        panels.forEach(p => p.classList.remove("active"));
        tab.classList.add("active");
        const id = tab.dataset.tab;
        document.getElementById(id).classList.add("active");
      });
    });

    // Init
    buildPlayerInputs();
    updateUI();
  </script>
</body>
</html>
